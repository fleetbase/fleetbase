<Overlay
    @onLoad={{this.setOverlayContext}}
    @onOpen={{this.onOpen}}
    @onClose={{this.onClose}}
    @onToggle={{this.onToggle}}
    @position="right"
    @noBackdrop={{true}}
    @fullHeight={{true}}
    @isResizable={{or this.isResizable @isResizable}}
    @width={{or this.width @width "570px"}}
>
    <Overlay::Header
        @title={{if this.order.public_id this.headerTitle (t "fleet-ops.common.order")}}
        @status={{this.order.public_id}}
        @hideStatusDot={{true}}
        @createdAt={{this.order.createdAt}}
        @titleWrapperClass="leading-5"
    >
        <div class="flex flex-1 justify-end">
            <Button
                @icon={{if this.order.id "save" "check"}}
                @type="primary"
                @text={{if this.order.id (t "fleet-ops.component.maintenance-schedule-form-panel.save") (t "fleet-ops.component.maintenance-schedule-form-panel.create")}}
                @onClick={{perform this.save}}
                @isLoading={{this.save.isRunning}}
                @permission={{this.savePermission}}
                @wrapperClass="mr-2"
            />
            {{#if this.order.id}}
                <Button
                    @type="default"
                    @icon="circle-exclamation"
                    @onClick={{this.onViewDetails}}
                    @wrapperClass="mr-2"
                    @permission="fleet-ops view order"
                />
            {{/if}}
            <Button
                @type="default"
                @icon="times"
                @onClick={{this.onPressCancel}}
            />
        </div>
    </Overlay::Header>

    <Overlay::Body @wrapperClass="px-4 pt-4">
        {{#let (cannot this.savePermission) as |unauthorized|}}
            <div class="grid grid-cols-1 text-xs dark:text-gray-100 gap-3">
                <InputGroup @name={{t "fleet-ops.operations.orders.index.vehicle-assigned"}} @required={{true}}>
                    <ModelSelect
                        @modelName="vehicle"
                        @selectedModel={{this.order.vehicle_assigned}}
                        @placeholder={{t "fleet-ops.operations.orders.index.vehicle-assigned"}}
                        @triggerClass="form-select form-input vehicle"
                        @infiniteScroll={{false}}
                        @renderInPlace={{true}}
                        @onChange={{fn (mut this.order.vehicle_assigned)}}
                        @disabled={{unauthorized}}
                        as |model|
                    >
                        {{model.display_name}}
                    </ModelSelect>
                </InputGroup>

                <InputGroup>
                    <InputLabel @labelText={{html-safe (concat (t "fleet-ops.common.schedule") " <span style='color: red;'>*</span>")}} />
                    <DateTimeInput
                        class="form-input"
                        @value={{this.order.scheduledAt}}
                        @minDate={{format-date (now) "yyyy-MM-dd"}}
                        @minTime={{format-date (now) "HH:mm"}}
                        @onUpdate={{this.setScheduledAt}}
                        @disabled={{unauthorized}}
                    />
                </InputGroup>

                <InputGroup>
                    <InputLabel @labelText={{t "fleet-ops.operations.orders.index.estimated-end-date"}} />
                    <DateTimeInput
                        class="form-input"
                        @value={{this.order.estimatedEndDate}}
                        @minDate={{format-date (now) "yyyy-MM-dd"}}
                        @minTime={{format-date (now) "HH:mm"}}
                        @onUpdate={{this.setEstimatedEndDate}}
                        @disabled={{unauthorized}}
                    />
                </InputGroup>

                <InputGroup @name={{t "fleet-ops.component.maintenance-schedule-form-panel.notes"}}>
                    <Textarea
                        @value={{this.order.notes}}
                        class="w-full form-input"
                        rows={{4}}
                        disabled={{unauthorized}}
                        placeholder={{t "fleet-ops.component.maintenance-schedule-form-panel.notes"}}
                    />
                </InputGroup>
            </div>
        {{/let}}
        <Spacer @height="300px" />
    </Overlay::Body>
</Overlay>
