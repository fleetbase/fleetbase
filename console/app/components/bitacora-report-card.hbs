<div class="bitacora-report-card" ...attributes>
    <div class="bitacora-report-card__container border dark:border-gray-700 border-gray-200 rounded-xl shadow-sm bg-white dark:bg-gray-900">
        <header class="bitacora-report-card__header">
            <div>
                <p class="bitacora-report-card__title">{{this.title}}</p>
                <p class="bitacora-report-card__subtitle">{{this.subtitle}}</p>
            </div>
            <div class="bitacora-report-card__controls">
                <PeriodSelector
                    @value={{this.selectedPeriod}}
                    @options={{this.periodOptions}}
                    @onChange={{this.handlePeriodChange}}
                    @label="Periodo"
                />
                <Button
                    @type="default"
                    @icon="sync"
                    @onClick={{this.handleRefresh}}
                    @disabled={{this.isLoading}}
                    @wrapperClass="bitacora-report-card__refresh-btn"
                    @helpText="Actualizar reportes"
                />
            </div>
        </header>

        <section class="bitacora-report-card__body">
            {{#if this.isLoading}}
                <div class="bitacora-report-card__loading">
                    <span class="bitacora-report-card__spinner">⏳</span>
                    <p>{{this.loadingLabel}}</p>
                </div>
            {{else if this.errorMessage}}
                <div class="bitacora-report-card__error">
                    <p>{{this.errorMessage}}</p>
                </div>
            {{else if this.hasSections}}
                {{#if this.showChart}}
                    <div class="bitacora-report-card__chart">
                        <BitacoraReportChart
                            @data={{this.chartData}}
                            @options={{this.chartOptions}}
                            @ariaLabel={{this.subtitle}}
                        />
                    </div>
                {{/if}}
                
                <ul class="bitacora-report-card__sections">
                    {{#each this.paginatedSections as |section|}}
                        <li class="bitacora-report-card__section">
                            <div class="bitacora-report-card__section-header">
                                <div>
                                    <p class="bitacora-report-card__section-name">{{section.name}}</p>
                                    {{#if section.lastActivityLabel}}
                                        <p class="bitacora-report-card__section-meta">
                                            {{section.lastActivityLabel}}
                                        </p>
                                    {{/if}}
                                </div>
                                <div class="bitacora-report-card__section-metrics">
                                    <span class="bitacora-report-card__section-total">{{section.total}}</span>
                                    {{#if section.trendDirection}}
                                        <span class="bitacora-report-card__trend bitacora-report-card__trend--{{section.trendDirection}}">
                                            {{#if (this.isTrendDown section.trendDirection)}}
                                                ↓
                                            {{else}}
                                                ↑
                                            {{/if}}
                                            {{section.trend}}
                                        </span>
                                    {{/if}}
                                </div>
                            </div>
                            <div class="bitacora-report-card__section-actions">
                                {{#if section.actions.length}}
                                    {{#each section.actions as |action|}}
                                        <span class="bitacora-report-card__action-chip">
                                            <span class="bitacora-report-card__action-label">{{action.label}}</span>
                                            <span class="bitacora-report-card__action-value">{{action.count}}</span>
                                        </span>
                                    {{/each}}
                                {{else}}
                                    <span class="bitacora-report-card__action-chip bitacora-report-card__action-chip--empty">
                                        Sin desglose disponible
                                    </span>
                                {{/if}}
                            </div>
                        </li>
                    {{/each}}
                </ul>

                {{#if this.hasPagination}}
                    <div class="bitacora-report-card__pagination">
                        <div class="bitacora-report-card__pagination-info">
                            <span>{{this.paginationInfo}}</span>
                        </div>
                        <div class="bitacora-report-card__pagination-controls">
                            <Button
                                @type="default"
                                @icon="chevron-left"
                                @size="xs"
                                @onClick={{this.goToPreviousPage}}
                                @disabled={{not this.canGoPrevious}}
                                @wrapperClass="bitacora-report-card__pagination-btn"
                                @helpText="Página anterior"
                            />
                            <span class="bitacora-report-card__pagination-current">
                                Página {{this.currentPage}} de {{this.totalPages}}
                            </span>
                            <Button
                                @type="default"
                                @icon="chevron-right"
                                @size="xs"
                                @onClick={{this.goToNextPage}}
                                @disabled={{not this.canGoNext}}
                                @wrapperClass="bitacora-report-card__pagination-btn"
                                @helpText="Página siguiente"
                            />
                        </div>
                    </div>
                {{/if}}
            {{else}}
                <div class="bitacora-report-card__empty">
                    <p>{{this.emptyLabel}}</p>
                </div>
            {{/if}}
        </section>

        <footer class="bitacora-report-card__footer">
            <div class="bitacora-report-card__footer-actions">
                {{#if this.hasSections}}
                    <Button
                        @type="default"
                        @text="CSV"
                        @icon="file-csv"
                        @size="xs"
                        @onClick={{fn this.handleExport "csv"}}
                        @wrapperClass="bitacora-report-card__export-btn"
                        @helpText="Exportar como CSV"
                    />
                    <Button
                        @type="default"
                        @text="Excel"
                        @icon="file-excel"
                        @size="xs"
                        @onClick={{fn this.handleExport "xlsx"}}
                        @wrapperClass="bitacora-report-card__export-btn"
                        @helpText="Exportar como Excel"
                    />
                    <Button
                        @type="default"
                        @text="PDF"
                        @icon="file-pdf"
                        @size="xs"
                        @onClick={{fn this.handleExport "pdf"}}
                        @wrapperClass="bitacora-report-card__export-btn"
                        @helpText="Imprimir / Guardar como PDF"
                    />
                {{/if}}
                <Button
                    @type="link"
                    @text="Ver detalles →"
                    @onClick={{this.handleViewDetails}}
                    @wrapperClass="bitacora-report-card__details-btn"
                />
            </div>
            {{#if this.lastUpdatedLabel}}
                <div class="bitacora-report-card__footer-timestamp">
                    <p class="bitacora-report-card__footer-text">
                        Actualizado {{this.lastUpdatedLabel}}
                    </p>
                </div>
            {{/if}}
        </footer>
    </div>
</div>
